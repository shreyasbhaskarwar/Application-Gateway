<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tracing, Log Correlation, Correlation Logging | NellyGateway</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="OWASP Application Gateway is an HTTP proxy that handles Oauth2 authentication and session management">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/Application-Gateway/assets/css/0.styles.3dd65460.css" as="style"><link rel="preload" href="/Application-Gateway/assets/js/app.eb0770ca.js" as="script"><link rel="preload" href="/Application-Gateway/assets/js/2.699db687.js" as="script"><link rel="preload" href="/Application-Gateway/assets/js/1.6f7f3e11.js" as="script"><link rel="preload" href="/Application-Gateway/assets/js/43.b6f478e4.js" as="script"><link rel="prefetch" href="/Application-Gateway/assets/js/10.bc770b30.js"><link rel="prefetch" href="/Application-Gateway/assets/js/11.4eb6f50c.js"><link rel="prefetch" href="/Application-Gateway/assets/js/12.a4dadbb2.js"><link rel="prefetch" href="/Application-Gateway/assets/js/13.c8c9becd.js"><link rel="prefetch" href="/Application-Gateway/assets/js/14.353d6eef.js"><link rel="prefetch" href="/Application-Gateway/assets/js/15.7e8a42c3.js"><link rel="prefetch" href="/Application-Gateway/assets/js/16.080d0551.js"><link rel="prefetch" href="/Application-Gateway/assets/js/17.68d7fb70.js"><link rel="prefetch" href="/Application-Gateway/assets/js/18.fc93894c.js"><link rel="prefetch" href="/Application-Gateway/assets/js/19.59a8dd5e.js"><link rel="prefetch" href="/Application-Gateway/assets/js/20.a728a170.js"><link rel="prefetch" href="/Application-Gateway/assets/js/21.8f6f4046.js"><link rel="prefetch" href="/Application-Gateway/assets/js/22.4d277477.js"><link rel="prefetch" href="/Application-Gateway/assets/js/23.939fb16e.js"><link rel="prefetch" href="/Application-Gateway/assets/js/24.a66362eb.js"><link rel="prefetch" href="/Application-Gateway/assets/js/25.d1abeace.js"><link rel="prefetch" href="/Application-Gateway/assets/js/26.c483d6d7.js"><link rel="prefetch" href="/Application-Gateway/assets/js/27.775b1151.js"><link rel="prefetch" href="/Application-Gateway/assets/js/28.85f19c8c.js"><link rel="prefetch" href="/Application-Gateway/assets/js/29.fee37c10.js"><link rel="prefetch" href="/Application-Gateway/assets/js/3.391fe791.js"><link rel="prefetch" href="/Application-Gateway/assets/js/30.1ea29242.js"><link rel="prefetch" href="/Application-Gateway/assets/js/31.bacd2655.js"><link rel="prefetch" href="/Application-Gateway/assets/js/32.37351ee7.js"><link rel="prefetch" href="/Application-Gateway/assets/js/33.c77f72df.js"><link rel="prefetch" href="/Application-Gateway/assets/js/34.8ef31509.js"><link rel="prefetch" href="/Application-Gateway/assets/js/35.135456be.js"><link rel="prefetch" href="/Application-Gateway/assets/js/36.cbeab818.js"><link rel="prefetch" href="/Application-Gateway/assets/js/37.56f4b3a3.js"><link rel="prefetch" href="/Application-Gateway/assets/js/38.cb156288.js"><link rel="prefetch" href="/Application-Gateway/assets/js/39.4fa15930.js"><link rel="prefetch" href="/Application-Gateway/assets/js/4.a04ccb9d.js"><link rel="prefetch" href="/Application-Gateway/assets/js/40.6c6a3b75.js"><link rel="prefetch" href="/Application-Gateway/assets/js/41.afba87f6.js"><link rel="prefetch" href="/Application-Gateway/assets/js/42.75ccb039.js"><link rel="prefetch" href="/Application-Gateway/assets/js/44.da5ff79b.js"><link rel="prefetch" href="/Application-Gateway/assets/js/45.296b9f77.js"><link rel="prefetch" href="/Application-Gateway/assets/js/46.56ed1a2d.js"><link rel="prefetch" href="/Application-Gateway/assets/js/47.0b42a792.js"><link rel="prefetch" href="/Application-Gateway/assets/js/5.4aba4ca2.js"><link rel="prefetch" href="/Application-Gateway/assets/js/6.c3403115.js"><link rel="prefetch" href="/Application-Gateway/assets/js/7.6acff8ff.js"><link rel="prefetch" href="/Application-Gateway/assets/js/vendors~docsearch.aae61d50.js">
    <link rel="stylesheet" href="/Application-Gateway/assets/css/0.styles.3dd65460.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Application-Gateway/" class="home-link router-link-active"><!----> <span class="site-name">NellyGateway</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Application-Gateway/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="https://app.swaggerhub.com/apis-docs/gianlucafrei/OAG/0.4#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Swagger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://owasp.org/www-project-application-gateway/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OWASP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/gianlucafrei/Application-Gateway/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Application-Gateway/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="https://app.swaggerhub.com/apis-docs/gianlucafrei/OAG/0.4#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Swagger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://owasp.org/www-project-application-gateway/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OWASP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/gianlucafrei/Application-Gateway/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Application-Gateway/docs/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/Application-Gateway/docs/Terms-you-need-to-understand.html" class="sidebar-link">Terms you need to understand</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Configuration</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Application-Gateway/docs/Configuration.html" class="sidebar-link">Overview</a></li><li><a href="/Application-Gateway/docs/Configuration-File.html" class="sidebar-link">OAG Configuration File</a></li><li><a href="/Application-Gateway/docs/Configuration-Login-Providers.html" class="sidebar-link">Login Providers</a></li><li><a href="/Application-Gateway/docs/Configuration-Routes.html" class="sidebar-link">Routes</a></li><li><a href="/Application-Gateway/docs/Configuration-SecurityProfiles.html" class="sidebar-link">Security Profiles</a></li><li><a href="/Application-Gateway/docs/Configuration-Session-Behaviour.html" class="sidebar-link">Session Behaviour</a></li><li><a href="/Application-Gateway/docs/Tracing-Log-Correlation-Correlation-Logging.html" aria-current="page" class="active sidebar-link">Tracing, Log Correlation, Correlation Logging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application-Gateway/docs/Tracing-Log-Correlation-Correlation-Logging.html#attributes-of-the-configuration" class="sidebar-link">Attributes of the configuration</a></li><li class="sidebar-sub-header"><a href="/Application-Gateway/docs/Tracing-Log-Correlation-Correlation-Logging.html#configuring-how-the-trace-id-is-written-to-the-log" class="sidebar-link">Configuring how the trace id is written to the log</a></li></ul></li><li><a href="/Application-Gateway/docs/Configuration-User-Mapping.html" class="sidebar-link">User Mapping</a></li><li><a href="/Application-Gateway/docs/Key-management-and-JWT-signer.html" class="sidebar-link">Key management and JWT signer</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Custom code extensions</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OAG API endpoints</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integrating with OAG</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>How To's</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tracing-log-correlation-correlation-logging"><a href="#tracing-log-correlation-correlation-logging" class="header-anchor">#</a> Tracing, Log Correlation, Correlation Logging</h1> <p>In this section we explain how the trace subsystem is configured.</p> <p>OAG comes with a set of tracing implementations. A unique trace id is applied to each request reaching OAG.
OAG can be configured if it should accept passed in trace id's from the caller (which we usually do not recommend).</p> <p>Currently OAG ships with these implementations of tracing:</p> <ul><li><code>w3cTrace</code>: The default implementation used by OAG is compliant with the <a href="https://w3c.github.io/trace-context/" target="_blank" rel="noopener noreferrer">W3C Trace Context specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and using the specified standard headers to communicate the trace id to downstream and upstream systems.</li> <li><code>simpleTrace</code>: An implementation using a simple UUID as unique trace id and a default header of X-Correlation-Id to pass the trace id to downstream systems.</li> <li><code>noTrace</code>: An implementation disabling all tracing functionality (which we do not recommend).</li></ul> <p>Example configuration as found in the main configuration file:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">traceProfile</span><span class="token punctuation">:</span>
  <span class="token key atrule">forwardIncomingTrace</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">maxLengthIncomingTrace</span><span class="token punctuation">:</span> <span class="token number">254</span>
  <span class="token key atrule">acceptAdditionalTraceInfo</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">maxLengthAdditionalTraceInfo</span><span class="token punctuation">:</span> <span class="token number">254</span>
  <span class="token key atrule">sendTraceResponse</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> w3cTrace
  <span class="token key atrule">traceImplSpecificSettings</span><span class="token punctuation">:</span>
    <span class="token key atrule">traceImplSpecificParameter</span><span class="token punctuation">:</span> <span class="token string">&quot;not used&quot;</span>
</code></pre></div><h2 id="attributes-of-the-configuration"><a href="#attributes-of-the-configuration" class="header-anchor">#</a> Attributes of the configuration</h2> <h3 id="traceprofile"><a href="#traceprofile" class="header-anchor">#</a> <code>traceProfile</code></h3> <p>The section name where tracing / log correlation relevant configuration is specified.<br>
Note that the exact means how trace information is sent to downstream and upstream systems (i.e. what http header names are used) is trace implementation specific and documented and defined by the trace implementation. Whatever additional information is required to be configured should be put in <code>traceImplSpecificSettings</code>.</p> <h3 id="forwardincomingtrace"><a href="#forwardincomingtrace" class="header-anchor">#</a> <code>forwardIncomingTrace</code></h3> <p>Default: false.<br>
Possible values: true, false<br>
Defines if an incoming trace id from an upstream system should be used by OAG internally and forwarded to downstream systems.
We recommend to keep the default value. Especially when OAG is the entry point into a trust zone (i.e. sits at the trust boundary). False means, that OAG always creates a new unique trace id for every request received from upstream systems and sends this to downstream systems.</p> <h3 id="maxlengthincomingtrace"><a href="#maxlengthincomingtrace" class="header-anchor">#</a> <code>maxLengthIncomingTrace</code></h3> <p>Default 254<br>
Possible values: 0..max Int<br>
Defines the maximum length that is accepted as an incoming (i.e. sent by upstream system) trace id. Should be as short as possible. Some trace implementations may ignore this value when for example it is specified how long the trace id can be.</p> <h3 id="acceptadditionaltraceinfo"><a href="#acceptadditionaltraceinfo" class="header-anchor">#</a> <code>acceptAdditionalTraceInfo</code></h3> <p>Default: false<br>
Possible values: true, false<br>
Defines if secondary trace info provided by upstream systems should be accepted by OAG (potentially internally used) and sent to downstream systems.
We recommend to keep the default for the same reason as stated for <code>forwardIncomingTrace</code>. Some trace implementations may not support secondary trace information in which case this setting is ignored.</p> <h3 id="maxlengthadditionaltraceinfo"><a href="#maxlengthadditionaltraceinfo" class="header-anchor">#</a> <code>maxLengthAdditionalTraceInfo</code></h3> <p>Default 254<br>
Possible values: 0..max Int<br>
Defines the maximum length that is accepted as incoming (i.e. sent by upstream system) additional trace info. Should be as short as possible. Some trace implementations may ignore this value when for example it is specified how long the additional trace info can be.</p> <h3 id="sendtraceresponse"><a href="#sendtraceresponse" class="header-anchor">#</a> <code>sendTraceResponse</code></h3> <p>Default: false<br>
Possible values: true, false<br>
Defines if OAG should send the used trace id to upstream systems. This may be useful to simply debugging from the client side.</p> <h3 id="type"><a href="#type" class="header-anchor">#</a> <code>type</code></h3> <p>Default: w3cTrace<br>
Possible values: w3cTrace, simpleTrace, noTrace, &lt;Beanname of custom trace implementation see <a href="/docs/Tracing-Log-Correlation">here</a>&gt;</p> <ul><li><code>w3cTrace</code>: Uses http-headers for upstream and downstream trace id communication as specified by <a href="https://w3c.github.io/trace-context/" target="_blank" rel="noopener noreferrer">W3C Trace Context<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Ignores <code>maxLengthIncomingTrace</code>as the length of a trace id is specified. Supports all other configuration options. Does not need any <code>traceImplSpecificSettings</code>.</li> <li><code>simpleTrace</code>: Creates a random UUID as trace id. Ignores the following configuration settings: <code>acceptAdditionalTraceInfo</code>,<code>maxLengthAdditionalTraceInfo</code> because it does not support any additional trace information beside the trace id. Uses as a default http-header X-Correlation-Id to communicate the trace id to upstream (depending on setting <code>sendTraceResponse</code>) and downstream systems. This can be customized by providing the following <code>traceImplSpecificSettings</code>:
<ul><li><code>headerName: &lt;X-your-header&gt;</code></li></ul></li> <li><code>noTrace</code>: Disabe tracing. Does only use a trace id for OAG internal logs, does not forward the traceId to downstream systems and does not take over any traceId from upstream systems. Ignores all trace configuration. This effectively disables the trace sub-system - which we do not recommend.</li> <li>Custom trace implementation: You can write your own trace implementation if you need. See <a href="/docs/Tracing-Log-Correlation">here</a> for instructions.</li></ul> <h2 id="configuring-how-the-trace-id-is-written-to-the-log"><a href="#configuring-how-the-trace-id-is-written-to-the-log" class="header-anchor">#</a> Configuring how the trace id is written to the log</h2> <p>In the file <code>application.yaml</code> you can change the log-pattern to match your needs where and how the trace id is logged with each statement. The trace id is available in the variable <code>oag.CorrId</code>. In the log pattern you can therefore use <code>%X{oag.CorrId}</code> to print the trace id.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Application-Gateway/docs/Configuration-Session-Behaviour.html" class="prev">
        Session Behaviour
      </a></span> <span class="next"><a href="/Application-Gateway/docs/Configuration-User-Mapping.html">
        User Mapping
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Application-Gateway/assets/js/app.eb0770ca.js" defer></script><script src="/Application-Gateway/assets/js/2.699db687.js" defer></script><script src="/Application-Gateway/assets/js/1.6f7f3e11.js" defer></script><script src="/Application-Gateway/assets/js/43.b6f478e4.js" defer></script>
  </body>
</html>
